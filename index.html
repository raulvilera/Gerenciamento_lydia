<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão de Equipamentos Tecnológicos</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    
    <!-- Bibliotecas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* (O estilo permanece o mesmo do seu código original) */
        :root { --primary-color: #2c3e50; --secondary-color: #34495e; --accent-color: #3498db; --success-color: #27ae60; --warning-color: #f39c12; --danger-color: #e74c3c; --info-color: #2980b9; --light-color: #ecf0f1; --dark-color: #2c3e50; --white: #ffffff; --gray-light: #bdc3c7; --gray-medium: #95a5a6; --gray-dark: #7f8c8d; --shadow: 0 4px 6px rgba(0, 0, 0, 0.1); --border-radius: 8px; --transition: all 0.3s ease; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f5f7fa; color: var(--dark-color); line-height: 1.6; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { background-color: var(--primary-color); color: var(--white); padding: 20px 0; box-shadow: var(--shadow); margin-bottom: 30px; position: sticky; top: 0; z-index: 100; }
        .header-content { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        .logo { font-size: 24px; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .logout-btn { background-color: var(--danger-color); color: white; border: none; padding: 8px 15px; border-radius: var(--border-radius); cursor: pointer; transition: var(--transition); }
        .logout-btn:hover { background-color: #c0392b; }
        .nav-tabs { display: flex; background-color: var(--secondary-color); border-radius: var(--border-radius); overflow: hidden; margin-bottom: 30px; }
        .nav-tab { padding: 15px 25px; color: var(--white); text-decoration: none; font-weight: 500; transition: var(--transition); cursor: pointer; text-align: center; flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .nav-tab:hover { background-color: rgba(255, 255, 255, 0.1); }
        .nav-tab.active { background-color: var(--accent-color); }
        .tab-content { display: none; background-color: var(--white); padding: 25px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 30px; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .form-title { margin-bottom: 20px; color: var(--primary-color); font-size: 22px; border-bottom: 2px solid var(--accent-color); padding-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--secondary-color); }
        .form-control { width: 100%; padding: 12px 15px; border: 1px solid var(--gray-light); border-radius: var(--border-radius); font-size: 16px; transition: var(--transition); }
        .form-control:focus { border-color: var(--accent-color); outline: none; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2); }
        select.form-control { appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 10px center; background-size: 15px; }
        .btn { padding: 12px 25px; border: none; border-radius: var(--border-radius); font-weight: 500; cursor: pointer; transition: var(--transition); font-size: 16px; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background-color: var(--accent-color); color: white; }
        .btn-primary:hover { background-color: #2980b9; }
        .btn-secondary { background-color: var(--gray-medium); color: white; }
        .btn-secondary:hover { background-color: var(--gray-dark); }
        .btn-success { background-color: var(--success-color); color: white; }
        .btn-success:hover { background-color: #219653; }
        .btn-danger { background-color: var(--danger-color); color: white; }
        .btn-danger:hover { background-color: #c0392b; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .table-responsive { overflow-x: auto; margin-bottom: 30px; }
        .data-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .data-table th, .data-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--gray-light); }
        .data-table th { background-color: var(--secondary-color); color: var(--white); font-weight: 500; text-transform: uppercase; font-size: 14px; }
        .data-table tr:hover { background-color: rgba(52, 152, 219, 0.05); }
        .badge { display: inline-block; padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .badge-primary { background-color: var(--accent-color); color: white; }
        .badge-success { background-color: var(--success-color); color: white; }
        .badge-warning { background-color: var(--warning-color); color: white; }
        .badge-danger { background-color: var(--danger-color); color: white; }
        .badge-info { background-color: var(--info-color); color: white; }
        .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background-color: var(--white); border-radius: var(--border-radius); box-shadow: var(--shadow); padding: 20px; transition: var(--transition); }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-title { font-size: 16px; color: var(--secondary-color); font-weight: 500; }
        .card-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; }
        .card-icon.primary { background-color: var(--accent-color); }
        .card-icon.success { background-color: var(--success-color); }
        .card-icon.warning { background-color: var(--warning-color); }
        .card-icon.danger { background-color: var(--danger-color); }
        .card-body { font-size: 28px; font-weight: bold; color: var(--primary-color); }
        .chart-container { background-color: var(--white); border-radius: var(--border-radius); box-shadow: var(--shadow); padding: 20px; margin-bottom: 30px; height: 400px; }
        .sub-nav-tabs { display: flex; background-color: #e9ecef; border-radius: var(--border-radius); overflow: hidden; margin-bottom: 20px; }
        .sub-nav-tab { padding: 12px 20px; color: var(--secondary-color); text-decoration: none; font-weight: 500; transition: var(--transition); cursor: pointer; text-align: center; flex: 1; }
        .sub-nav-tab:hover { background-color: rgba(52, 152, 219, 0.1); }
        .sub-nav-tab.active { background-color: var(--accent-color); color: white; }
        .sub-tab-content { display: none; }
        .sub-tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        .register-form { background-color: #f8f9fa; padding: 25px; border-radius: var(--border-radius); margin-bottom: 30px; }
        .equipment-row { display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-end; }
        .equipment-row > div { flex: 1; }
        .add-equipment-btn { background-color: var(--success-color); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .remove-equipment-btn { background-color: var(--danger-color); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .time-input-group { display: flex; gap: 10px; }
        .time-input-group .form-group { flex: 1; }
        .auto-fill-label { font-size: 12px; color: var(--gray-dark); margin-top: 5px; }
        .registration-codes { background-color: #e8f4fc; padding: 15px; border-radius: var(--border-radius); margin-bottom: 20px; }
        .registration-codes h4 { margin-bottom: 10px; color: var(--primary-color); }
        .codes-list { display: flex; flex-wrap: wrap; gap: 10px; }
        .code-item { background-color: var(--accent-color); color: white; padding: 5px 10px; border-radius: 4px; font-size: 14px; }
        .termo-container { padding: 20px; background-color: white; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-top: 20px; }
        .termo-title { text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 20px; color: var(--primary-color); }
        .termo-content { line-height: 1.8; }
        .termo-signature { margin-top: 40px; text-align: center; }
        .termo-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .termo-table th, .termo-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .termo-table th { background-color: #f2f2f2; }
        .termo-info { display: flex; justify-content: space-between; margin-top: 20px; }
        .termo-info-item { flex: 1; }
        .download-btn { margin-top: 20px; text-align: center; }
        .filter-container { background-color: var(--white); padding: 15px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 15px; }
        .filter-group { flex: 1; min-width: 200px; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 5px; }
        .status-available { background-color: var(--success-color); }
        .status-inuse { background-color: var(--accent-color); }
        .status-maintenance { background-color: var(--warning-color); }
        .status-damaged { background-color: var(--danger-color); }
        .status-unused { background-color: var(--gray-medium); }
        .connection-status { position: fixed; bottom: 20px; right: 20px; padding: 10px 15px; border-radius: var(--border-radius); color: white; z-index: 1000; display: flex; align-items: center; gap: 8px; }
        .connection-status.connected { background-color: var(--success-color); }
        .connection-status.disconnected { background-color: var(--danger-color); }
        .status-pulse { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
        .status-pulse.connected { background-color: var(--success-color); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        @media (max-width: 768px) { .nav-tabs { flex-wrap: wrap; } .nav-tab { flex: 1 0 33%; padding: 12px 5px; font-size: 14px; } .form-grid { grid-template-columns: 1fr; } .btn-group { flex-direction: column; } .btn { width: 100%; } .equipment-row { flex-direction: column; gap: 10px; } .filter-container { flex-direction: column; } }
    </style>
</head>
<body>
    <div id="connectionStatus" class="connection-status disconnected">
        <span class="status-pulse"></span> Firebase: desconectado
    </div>

    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-laptop"></i>
                Sistema Integrado de Gestão de Equipamentos
            </div>
            <div class="user-info">
                <span id="currentUser">Administrador</span>
                <button class="logout-btn" onclick="logout()">Sair</button>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="openTab('dashboard')">
                <i class="fas fa-chart-line"></i> Dashboard
            </div>
            <div class="nav-tab" onclick="openTab('register')">
                <i class="fas fa-cubes"></i> Cadastro
            </div>
            <div class="nav-tab" onclick="openTab('reservations')">
                <i class="fas fa-calendar-alt"></i> Reservas
            </div>
            <div class="nav-tab" onclick="openTab('reports')">
                <i class="fas fa-file-alt"></i> Relatórios
            </div>
            <div class="nav-tab" onclick="openTab('maintenance')">
                <i class="fas fa-tools"></i> Manutenção
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="tab-content active">
            <h2 class="form-title">
                <i class="fas fa-chart-line"></i> Dashboard Geral
            </h2>
            
            <div class="dashboard-cards">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Em Uso</div>
                        <div class="card-icon primary">
                            <i class="fas fa-laptop"></i>
                        </div>
                    </div>
                    <div class="card-body" id="inUseCount">0</div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Disponíveis</div>
                        <div class="card-icon success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <div class="card-body" id="availableCount">0</div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Em Manutenção</div>
                        <div class="card-icon warning">
                            <i class="fas fa-tools"></i>
                        </div>
                    </div>
                    <div class="card-body" id="maintenanceCount">0</div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Com Avarias</div>
                        <div class="card-icon danger">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                    </div>
                    <div class="card-body" id="damagedCount">0</div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="equipmentStatusChart"></canvas>
            </div>
            
            <h3 style="margin-bottom: 15px;">Últimos Registros</h3>
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Professor</th>
                            <th>Equipamento</th>
                            <th>Quantidade</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="lastRecordsBody">
                        <!-- Dados serão preenchidos via Firebase -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Cadastro e Registro -->
        <div id="register" class="tab-content">
            <h2 class="form-title">
                <i class="fas fa-cubes"></i> Cadastro e Registro de Equipamentos
            </h2>
            
            <div class="sub-nav-tabs">
                <div class="sub-nav-tab active" onclick="openSubTab('equipmentRegister')">Cadastro de Equipamentos</div>
                <div class="sub-nav-tab" onclick="openSubTab('withdrawalRegister')">Registro de Retirada/Entrega</div>
            </div>
            
            <!-- Cadastro de Equipamentos -->
            <div id="equipmentRegister" class="sub-tab-content active">
                <div class="filter-container">
                    <div class="filter-group">
                        <label for="equipmentSearch">Pesquisar</label>
                        <input type="text" id="equipmentSearch" class="form-control" placeholder="Digite para pesquisar..." oninput="filterEquipment()">
                    </div>
                    <div class="filter-group">
                        <label for="filterStatus">Status</label>
                        <select id="filterStatus" class="form-control" onchange="filterEquipment()">
                            <option value="all">Todos</option>
                            <option value="Disponível">Disponível</option>
                            <option value="Em uso">Em uso</option>
                            <option value="Manutenção">Manutenção</option>
                            <option value="Com avarias">Com avarias</option>
                            <option value="Desuso">Desuso</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary" onclick="showAddEquipmentModal()">
                            <i class="fas fa-plus"></i> Novo Equipamento
                        </button>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data Registro</th>
                                <th>Nº de Série</th>
                                <th>Nº Registro</th>
                                <th>Equipamento</th>
                                <th>Local</th>
                                <th>Quantidade</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="equipmentTableBody">
                            <!-- Dados serão preenchidos via Firebase -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Registro de Retirada/Entrega -->
            <div id="withdrawalRegister" class="sub-tab-content">
                <div class="register-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="teacherName">NOME DO PROFESSOR:</label>
                            <select id="teacherName" class="form-control" onchange="fillTeacherEmail()">
                                <option value="">Selecione o professor</option>
                                <!-- Dados serão preenchidos via Firebase -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="teacherEmail">E-MAIL:</label>
                            <input type="email" id="teacherEmail" class="form-control" readonly>
                            <div class="auto-fill-label">Preenchimento automático ao selecionar o professor</div>
                        </div>
                    </div>
                    
                    <h3 style="margin: 20px 0 15px; color: var(--primary-color);">Equipamentos</h3>
                    
                    <div id="equipmentContainer">
                        <div class="equipment-row">
                            <div class="form-group">
                                <label for="equipmentType">APARELHO:</label>
                                <select id="equipmentType" class="form-control" onchange="updateIdentificationNumbers()">
                                    <option value="">Selecione o aparelho</option>
                                    <!-- Dados serão preenchidos via Firebase -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="identificationNumber">N° DE IDENTIFICAÇÃO:</label>
                                <select id="identificationNumber" class="form-control" onchange="fillSerialNumber()">
                                    <option value="">Selecione o aparelho primeiro</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="serialNumber">N° DE SÉRIE:</label>
                                <input type="text" id="serialNumber" class="form-control" readonly>
                                <div class="auto-fill-label">Preenchido automaticamente quando possível</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="quantity">QUANTIDADE:</label>
                                <input type="number" id="quantity" class="form-control" min="1" value="1">
                            </div>
                            
                            <button class="remove-equipment-btn" onclick="removeEquipmentRow(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="addEquipmentRow()">
                        <i class="fas fa-plus"></i> Adicionar Equipamento
                    </button>
                    
                    <div class="form-grid" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="studentClass">TURMA:</label>
                            <select id="studentClass" class="form-control" required onchange="updateRoom()">
                                <option value="">Selecione a turma</option>
                                <!-- Dados serão preenchidos via Firebase -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="room">SALA:</label>
                            <input type="text" id="room" class="form-control" readonly>
                            <div class="auto-fill-label">Preenchimento automático com base na turma</div>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="withdrawalDate">DATA DA RETIRADA:</label>
                            <input type="date" id="withdrawalDate" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="returnDate">DATA DA ENTREGA:</label>
                            <input type="date" id="returnDate" class="form-control">
                        </div>
                    </div>
                    
                    <div class="time-input-group">
                        <div class="form-group">
                            <label for="withdrawalTime">HORÁRIO DA RETIRADA:</label>
                            <input type="time" id="withdrawalTime" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="returnTime">HORÁRIO DA ENTREGA:</label>
                            <input type="time" id="returnTime" class="form-control">
                        </div>
                    </div>
                    
                    <div class="registration-codes">
                        <h4>CÓDIGOS DE REGISTRO:</h4>
                        <div class="codes-list" id="codesList">
                            <!-- Dados serão preenchidos via Firebase -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="registrationCode">CÓDIGO DO REGISTRO *</label>
                        <input type="text" id="registrationCode" class="form-control" placeholder="Digite o código de registro (ex: PROATI - 001)" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="observation">OBSERVAÇÃO:</label>
                        <textarea id="observation" class="form-control" rows="3" placeholder="Observações adicionais"></textarea>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="registerWithdrawal()">
                            <i class="fas fa-save"></i> REGISTRAR
                        </button>
                        <button class="btn btn-secondary" onclick="clearWithdrawalForm()">
                            <i class="fas fa-eraser"></i> LIMPAR
                        </button>
                    </div>
                </div>
                
                <div class="termo-container">
                    <h3 class="termo-title">TERMO DE RESPONSABILIDADE PELO USO E DEVOLUÇÃO DE APARELHOS</h3>
                    <div class="termo-content">
                        <p>
                            Eu, <span id="termoTeacherName">ADEMAR RIBEIRO DE SOUZA</span>, 
                            professor(a) da turma <span id="termoClass">4050 - ADMINISTRAÇÃO - 2ª SERIE A MANHA</span>, 
                            declaro estar ciente e de acordo com as responsabilidades quanto ao uso dos aparelhos listados abaixo, 
                            os quais foram retirados em perfeitas condições de funcionamento.
                        </p>
                        
                        <p>Comprometo-me a:</p>
                        <ul>
                            <li>Zelar pelo bom uso dos aparelhos sob minha posse e dos meus alunos durante o período de utilização;</li>
                            <li>Devolver todos os equipamentos nas mesmas condições em que foram entregues;</li>
                        </ul>
                        
                        <p><strong>OBSERVAÇÃO:</strong> Comunicar imediatamente qualquer dano ou irregularidade ocorrida durante o uso.</p>
                        
                        <table class="termo-table">
                            <thead>
                                <tr>
                                    <th>Aparelho</th>
                                    <th>N° Identificação</th>
                                    <th>N° Série</th>
                                    <th>Quantidade</th>
                                </tr>
                            </thead>
                            <tbody id="termoEquipmentBody">
                                <!-- Conteúdo será gerado automaticamente -->
                            </tbody>
                        </table>
                        
                        <div class="termo-info">
                            <div class="termo-info-item">
                                <p>Assinatura do(a) Professor(a): ____________________________________________</p>
                            </div>
                            <div class="termo-info-item">
                                <p>Turma: <span id="termoClass2">4050 - ADMINISTRAÇÃO - 2ª SERIE A MANHA</span></p>
                            </div>
                        </div>
                        
                        <div class="termo-info">
                            <div class="termo-info-item">
                                <p>Data da Retirada: <span id="termoWithdrawalDate">10/06/2023</span></p>
                            </div>
                            <div class="termo-info-item">
                                <p>Horário da Retirada: <span id="termoWithdrawalTime">08:30</span></p>
                            </div>
                        </div>
                        
                        <div class="termo-info">
                            <div class="termo-info-item">
                                <p>Data da Devolução: <span id="termoReturnDate">12/06/2023</span></p>
                            </div>
                            <div class="termo-info-item">
                                <p>Horário da Devolução: <span id="termoReturnTime">10:45</span></p>
                            </div>
                        </div>
                        
                        <div class="termo-signature">
                            <p>Registrado por: <span id="termoRegistrant">Raul Pereira</span></p>
                            <p>Código: <span id="termoRegistrationCode">PROATI - 001</span></p>
                        </div>
                    </div>
                    
                    <div class="download-btn">
                        <button class="btn btn-primary" onclick="downloadTermoPDF()">
                            <i class="fas fa-download"></i> Baixar Termo em PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Outras abas (simplificadas para demonstração) -->
        <div id="reservations" class="tab-content">
            <h2 class="form-title">
                <i class="fas fa-calendar-alt"></i> Gestão de Reservas
            </h2>
            <p>Conteúdo da aba de reservas será exibido aqui.</p>
        </div>
        
        <div id="reports" class="tab-content">
            <h2 class="form-title">
                <i class="fas fa-file-alt"></i> Relatórios
            </h2>
            <p>Conteúdo da aba de relatórios será exibido aqui.</p>
        </div>
        
        <div id="maintenance" class="tab-content">
            <h2 class="form-title">
                <i class="fas fa-tools"></i> Manutenção
            </h2>
            <p>Conteúdo da aba de manutenção será exibido aqui.</p>
        </div>
    </div>

    <!-- Modal para adicionar novo equipamento -->
    <div id="addEquipmentModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="background-color: white; margin: 5% auto; padding: 20px; border-radius: var(--border-radius); width: 80%; max-width: 600px;">
            <h2 style="margin-bottom: 20px;">Adicionar Novo Equipamento</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="newEquipmentType">Tipo de Equipamento:</label>
                    <input type="text" id="newEquipmentType" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newSerialNumber">Número de Série:</label>
                    <input type="text" id="newSerialNumber" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newRegistrationNumber">Número de Registro:</label>
                    <input type="text" id="newRegistrationNumber" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newLocation">Local:</label>
                    <input type="text" id="newLocation" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="newQuantity">Quantidade:</label>
                    <input type="number" id="newQuantity" class="form-control" min="1" value="1" required>
                </div>
                <div class="form-group">
                    <label for="newStatus">Status:</label>
                    <select id="newStatus" class="form-control" required>
                        <option value="Disponível">Disponível</option>
                        <option value="Em uso">Em uso</option>
                        <option value="Manutenção">Manutenção</option>
                        <option value="Com avarias">Com avarias</option>
                        <option value="Desuso">Desuso</option>
                    </select>
                </div>
            </div>
            <div class="btn-group" style="margin-top: 20px;">
                <button class="btn btn-success" onclick="saveNewEquipment()">Salvar</button>
                <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
         // Configuração CORRIGIDA do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBOoXyLQPfgzQM06LVy-TRSPdSM_8CjcE",
            authDomain: "gerenciamentoaparelho.firebaseapp.com",
            databaseURL: "https://gerenciamentoaparelho-default-rtdb.firebaseio.com",
            projectId: "gerenciamentoaparelho",
            storageBucket: "gerenciamentoaparelho.appspot.com",
            messagingSenderId: "751628186418",
            appId: "1:751628186418:web:dd68af74d9e3723c179d2b",
            measurementId: "G-K022ZQ4JBK"
        };

        // Inicialização CORRIGIDA do Firebase
        try {
            // Verifica se já existe um app Firebase inicializado
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            
            const database = firebase.database();
            const auth = firebase.auth();
            
            console.log("Firebase inicializado com sucesso!");
        } catch (error) {
            console.error("Erro ao inicializar Firebase:", error);
        }

        
        // Função para atualizar o status de conexão
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            const pulseElement = statusElement.querySelector('.status-pulse');
            
            if (firebaseConnected) {
                statusElement.className = 'connection-status connected';
                statusElement.innerHTML = '<span class="status-pulse connected"></span> Firebase: conectado';
            } else {
                statusElement.className = 'connection-status disconnected';
                statusElement.innerHTML = '<span class="status-pulse"></span> Firebase: desconectado';
            }
        }

        // Dados de exemplo (serão substituídos por dados do Firebase)
        let professores = {};
        let salasPorTurmaPeriodo = {};
        let equipamentos = {};
        let registrantes = {};
        
        // Funções para navegação
        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
            
            if(tabId === 'register') openSubTab('equipmentRegister');
        }
        
        function openSubTab(subTabId) {
            document.querySelectorAll('.sub-tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.sub-nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(subTabId).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // Preencher e-mail do professor automaticamente
        function fillTeacherEmail() {
            const teacherSelect = document.getElementById('teacherName');
            const emailInput = document.getElementById('teacherEmail');
            const selectedTeacher = teacherSelect.value;
            
            if (professores[selectedTeacher]) {
                emailInput.value = professores[selectedTeacher];
            } else {
                emailInput.value = '';
            }
        }
        
        // Atualizar números de identificação com base no aparelho selecionado
        function updateIdentificationNumbers() {
            const equipmentTypeSelect = document.getElementById('equipmentType');
            const identificationNumberSelect = document.getElementById('identificationNumber');
            const selectedEquipment = equipmentTypeSelect.value;
            
            identificationNumberSelect.innerHTML = '<option value="">Selecione o aparelho primeiro</option>';
            
            if (selectedEquipment && equipamentos[selectedEquipment]) {
                equipamentos[selectedEquipment].forEach(eq => {
                    const option = document.createElement('option');
                    option.value = eq.id;
                    option.textContent = eq.id;
                    identificationNumberSelect.appendChild(option);
                });
            }
        }
        
        // Preencher número de série automaticamente
        function fillSerialNumber() {
            const equipmentTypeSelect = document.getElementById('equipmentType');
            const identificationNumberSelect = document.getElementById('identificationNumber');
            const serialNumberInput = document.getElementById('serialNumber');
            const selectedEquipment = equipmentTypeSelect.value;
            const selectedId = identificationNumberSelect.value;
            
            if (selectedEquipment && selectedId && equipamentos[selectedEquipment]) {
                const equipment = equipamentos[selectedEquipment].find(eq => eq.id === selectedId);
                if (equipment) {
                    serialNumberInput.value = equipment.serial;
                    return;
                }
            }
            
            serialNumberInput.value = '';
        }
        
        // Atualizar sala com base na turma selecionada
        function updateRoom() {
            const classSelect = document.getElementById('studentClass');
            const roomInput = document.getElementById('room');
            const selectedClass = classSelect.value;
            
            if (salasPorTurmaPeriodo[selectedClass]) {
                roomInput.value = salasPorTurmaPeriodo[selectedClass];
            } else {
                roomInput.value = '';
            }
        }
        
        // Adicionar novo campo de equipamento
        function addEquipmentRow() {
            const container = document.getElementById('equipmentContainer');
            const newRow = document.createElement('div');
            newRow.className = 'equipment-row';
            newRow.innerHTML = `
                <div class="form-group">
                    <label>APARELHO:</label>
                    <select class="form-control equipment-type" onchange="updateIdentificationNumbersInRow(this)">
                        <option value="">Selecione o aparelho</option>
                        ${Object.keys(equipamentos).map(type => 
                            `<option value="${type}">${type}</option>`
                        ).join('')}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>N° DE IDENTIFICAÇÃO:</label>
                    <select class="form-control identification-number" onchange="fillSerialNumberInRow(this)">
                        <option value="">Selecione o aparelho primeiro</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>N° DE SÉRIE:</label>
                    <input type="text" class="form-control serial-number" readonly>
                    <div class="auto-fill-label">Preenchido automaticamente quando possível</div>
                </div>
                
                <div class="form-group">
                    <label>QUANTIDADE:</label>
                    <input type="number" class="form-control quantity" min="1" value="1">
                </div>
                
                <button class="remove-equipment-btn" onclick="removeEquipmentRow(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(newRow);
        }
        
        function removeEquipmentRow(button) {
            const row = button.closest('.equipment-row');
            if (row && row.parentNode.children.length > 1) {
                row.remove();
            } else {
                alert("Você precisa ter pelo menos um equipamento registrado!");
            }
        }
        
        function updateIdentificationNumbersInRow(selectElement) {
            const row = selectElement.closest('.equipment-row');
            const identificationSelect = row.querySelector('.identification-number');
            const serialInput = row.querySelector('.serial-number');
            const selectedEquipment = selectElement.value;
            
            identificationSelect.innerHTML = '<option value="">Selecione o aparelho primeiro</option>';
            serialInput.value = '';
            
            if (selectedEquipment && equipamentos[selectedEquipment]) {
                equipamentos[selectedEquipment].forEach(eq => {
                    const option = document.createElement('option');
                    option.value = eq.id;
                    option.textContent = eq.id;
                    identificationSelect.appendChild(option);
                });
            }
        }
        
        function fillSerialNumberInRow(selectElement) {
            const row = selectElement.closest('.equipment-row');
            const equipmentSelect = row.querySelector('.equipment-type');
            const serialInput = row.querySelector('.serial-number');
            const selectedEquipment = equipmentSelect.value;
            const selectedId = selectElement.value;
            
            if (selectedEquipment && selectedId && equipamentos[selectedEquipment]) {
                const equipment = equipamentos[selectedEquipment].find(eq => eq.id === selectedId);
                if (equipment) {
                    serialInput.value = equipment.serial;
                    return;
                }
            }
            
            serialInput.value = '';
        }
        
        // Função para logout
        function logout() {
            alert('Sessão encerrada com sucesso!');
        }
        
        // Funções para o modal
        function showAddEquipmentModal() {
            document.getElementById('addEquipmentModal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('addEquipmentModal').style.display = 'none';
        }
        
        function saveNewEquipment() {
            // Aqui você salvaria no Firebase
            alert('Equipamento salvo com sucesso!');
            closeModal();
        }
        
        // Função para simular conexão com o Firebase
        function simulateFirebaseConnection() {
            // Dados de professores
            professores = {
                "ADEMAR RIBEIRO DE SOUZA": "ademarribeirosouza@prof.educacao.sp.gov.br",
                "ALEX LUTH PEREIRA MARANHAO": "luth@prof.educacao.sp.gov.br",
                "ALEXANDRE SILVA LIMA": "alexandresilvalima@prof.educacao.sp.gov.br",
                "WILSON RODRIGUES MOTA": "wmota@prof.educacao.sp.gov.br"
            };
            
            // Preencher select de professores
            const teacherSelect = document.getElementById('teacherName');
            teacherSelect.innerHTML = '<option value="">Selecione o professor</option>';
            for (const [name, email] of Object.entries(professores)) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                teacherSelect.appendChild(option);
            }
            
            // Dados das salas por turma
            salasPorTurmaPeriodo = {
                "6° ANO A MANHA": "Sala 1",
                "6° ANO B MANHA": "Sala 2",
                "4050 - ADMINISTRAÇÃO - 2ª SERIE A MANHA": "Laboratório 1"
            };
            
            // Preencher select de turmas
            const classSelect = document.getElementById('studentClass');
            classSelect.innerHTML = '<option value="">Selecione a turma</option>';
            for (const turma of Object.keys(salasPorTurmaPeriodo)) {
                const option = document.createElement('option');
                option.value = turma;
                option.textContent = turma;
                classSelect.appendChild(option);
            }
            
            // Dados de equipamentos
            equipamentos = {
                "NOTEBOOK": [
                    { id: "NB001", serial: "SN123456789" },
                    { id: "NB002", serial: "SN987654321" },
                    { id: "NB003", serial: "SN456789123" }
                ],
                "TABLET": [
                    { id: "TAB001", serial: "SNTAB001" },
                    { id: "TAB002", serial: "SNTAB002" },
                    { id: "TAB003", serial: "SNTAB003" }
                ],
                "SMARTPHONE": [
                    { id: "SP001", serial: "SNSP001" },
                    { id: "SP002", serial: "SNSP002" }
                ],
                "HEAD SET": [
                    { id: "HS001", serial: "SNHS001" },
                    { id: "HS002", serial: "SNHS002" }
                ],
                "CHROMEBOOK": [
                    { id: "CB001", serial: "SNCB001" },
                    { id: "CB002", serial: "SNCB002" }
                ],
                "CAIXA DE SOM": [
                    { id: "CS001", serial: "SNCS001" },
                    { id: "CS002", serial: "SNCS002" }
                ]
            };
            
            // Preencher select de equipamentos
            const equipmentSelect = document.getElementById('equipmentType');
            equipmentSelect.innerHTML = '<option value="">Selecione o aparelho</option>';
            for (const equipment of Object.keys(equipamentos)) {
                const option = document.createElement('option');
                option.value = equipment;
                option.textContent = equipment;
                equipmentSelect.appendChild(option);
            }
            
            // Dados dos registrantes
            registrantes = {
                "PROATI - 001": "Raul Pereira Vilera Junior",
                "PROATI - 002": "Juarez Gomes de Magalhães Filho",
                "PROATI - 003": "Júlio César Oliveira",
                "CGP - 004": "Erineide Leite Aragão Nery",
                "CGP - 005": "Patrícia Gomes Rocha Ribeiro"
            };
            
            // Preencher códigos de registro
            const codesList = document.getElementById('codesList');
            for (const [code, name] of Object.entries(registrantes)) {
                const codeItem = document.createElement('div');
                codeItem.className = 'code-item';
                codeItem.textContent = `${code} (${name.split(' ')[0]})`;
                codesList.appendChild(codeItem);
            }
            
            // Preencher dados no dashboard
            document.getElementById('inUseCount').textContent = '12';
            document.getElementById('availableCount').textContent = '45';
            document.getElementById('maintenanceCount').textContent = '8';
            document.getElementById('damagedCount').textContent = '5';
            
            // Preencher últimos registros
            const lastRecordsBody = document.getElementById('lastRecordsBody');
            const records = [
                { date: '10/06/2023', teacher: 'Alex Luth Pereira Maranhão', equipment: 'Notebook', quantity: 15, status: 'Devolvido' },
                { date: '09/06/2023', teacher: 'Ademar Ribeiro de Souza', equipment: 'Tablet', quantity: 10, status: 'Em uso' },
                { date: '08/06/2023', teacher: 'Wilson Rodrigues Mota', equipment: 'Chromebook', quantity: 20, status: 'Devolvido' }
            ];
            
            for (const record of records) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.date}</td>
                    <td>${record.teacher}</td>
                    <td>${record.equipment}</td>
                    <td>${record.quantity}</td>
                    <td><span class="badge badge-${record.status === 'Devolvido' ? 'success' : 'primary'}">${record.status}</span></td>
                `;
                lastRecordsBody.appendChild(row);
            }
            
            // Preencher tabela de equipamentos
            const equipmentTableBody = document.getElementById('equipmentTableBody');
            const equipmentData = [
                { date: '05/06/2023', serial: 'SN123456789', id: 'NB001', type: 'Notebook', location: 'Sala dos Professores', quantity: 1, status: 'Disponível' },
                { date: '04/06/2023', serial: 'SNTAB001', id: 'TAB001', type: 'Tablet', location: 'Sala de Informática', quantity: 1, status: 'Em uso' },
                { date: '03/06/2023', serial: 'SNCB001', id: 'CB001', type: 'Chromebook', location: 'Laboratório 1', quantity: 1, status: 'Manutenção' }
            ];
            
            for (const equipment of equipmentData) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${equipment.date}</td>
                    <td>${equipment.serial}</td>
                    <td>${equipment.id}</td>
                    <td>${equipment.type}</td>
                    <td>${equipment.location}</td>
                    <td>${equipment.quantity}</td>
                    <td><span class="badge badge-${getBadgeClass(equipment.status)}">${equipment.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                equipmentTableBody.appendChild(row);
            }
        }
        
        function getBadgeClass(status) {
            switch(status) {
                case 'Disponível': return 'success';
                case 'Em uso': return 'primary';
                case 'Manutenção': return 'warning';
                case 'Com avarias': return 'danger';
                default: return 'info';
            }
        }
        
        function filterEquipment() {
            // Implementar filtragem de equipamentos
            console.log("Filtrando equipamentos...");
        }
        
        function registerWithdrawal() {
            // Implementar registro de retirada
            alert("Retirada registrada com sucesso!");
        }
        
        function clearWithdrawalForm() {
            document.getElementById('withdrawalRegisterForm').reset();
        }
        
        function downloadTermoPDF() {
            // Implementar geração de PDF
            alert("Termo baixado em PDF!");
        }
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar gráfico
            const ctx = document.getElementById('equipmentStatusChart').getContext('2d');
            const equipmentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Em Uso', 'Disponíveis', 'Manutenção', 'Com Avarias', 'Desuso'],
                    datasets: [{
                        data: [12, 45, 8, 5, 3],
                        backgroundColor: [
                            '#3498db',
                            '#27ae60',
                            '#f39c12',
                            '#e74c3c',
                            '#95a5a6'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        title: {
                            display: true,
                            text: 'Status dos Equipamentos',
                            font: {
                                size: 16
                            }
                        }
                    }
                }
            });
            
            // Configurar datas atuais
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('withdrawalDate').value = today;
            document.getElementById('returnDate').value = today;
            
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const time = `${hours}:${minutes}`;
            
            document.getElementById('withdrawalTime').value = time;
            document.getElementById('returnTime').value = time;
            
            // Simular conexão com o Firebase
            simulateFirebaseConnection();
        });
    </script>
</body>
</html>
